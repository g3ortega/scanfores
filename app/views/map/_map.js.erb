$(document).ready(function() {
    var map;
    var centre = new google.maps.LatLng(13.1864581,-85.9448642);

    function initialize() {
	map = new google.maps.Map(document.getElementById('map'),
			          { center: centre, zoom: 14,
                                    mapTypeId: google.maps.MapTypeId.HYBRID,
                                    zoomControlOptions: {
                                        style: google.maps.ZoomControlStyle.LARGE
                                    },
                                    streetViewControl: false });
        setMarkers(map, locats);
    }

    var locats =[]
    var alertcircle;
    <% @alerts.each do |alert| %>
    locats.push(['<%=  alert.description %>','<%=  alert.lat %>','<%=  alert.lon %>']);
    <%end%>

    function setMarkers(map, locations) {

        var shape = {
            coords: [1, 1, 1, 20, 18, 20, 18 , 1],
            type: 'poly'
        };
        var markert=[];
        for (var i = 0; i < locats.length; i++) {
            var location = locats[i];
            var myLatLng = new google.maps.LatLng(location[1], location[2]);
            var image = {
                //url: "<%= asset_path('maakab.png') %>",
                // This marker is 20 pixels wide by 32 pixels tall.
                size: new google.maps.Size(20, 32),
                // The origin for this image is 0,0.
                origin: new google.maps.Point(0,0),

                anchor: new google.maps.Point(0, 32)
            };
            var circe = {
                fillColor: '#4ae3ff',//'RoyalBlue',
                strokeColor: '#FF3333',//"DarkBlue",
                strokeOpacity: 0.3,
                strokeWeight: 2.3,
                fillOpacity: 0.03,
                center:  myLatLng,
                radius: 100
            };
            var marker = new google.maps.Marker({
                position: myLatLng,
                map: map,
                icon: image,
               // shape: shape,
                title: location[0],
                zIndex: location[3]
            });

            markert.push(marker);
            alertcircle= new google.maps.Circle(circe);

        }
        var markercluster = new MarkerClusterer(map, markert);
    }

    google.maps.event.addDomListener(window, 'load', initialize);
});
